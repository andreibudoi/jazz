import { CodeGroup } from '@/components/forMdx'

# Jazz 0.16.0 - Cleaner separation between Zod and CoValue schemas

This release introduces a cleaner separation between Zod and CoValue schemas and simplifies how you access internal schemas.
While most applications won’t require extensive refactors, some breaking changes will require action.

## Breaking changes

### Schema composition rules are now stricter

Zod schemas can only be composed with other Zod schemas. CoValue schemas can be composed with either Zod or other CoValue schemas.

#### `z.optional()` and `z.discriminatedUnion()` no longer work with CoValue schemas

You’ll now need to use the `co.optional()` and `co.discriminatedUnion()` equivalents.
This change may require you to update any explicitly typed cyclic references.

<CodeGroup>
```tsx
import { co, z } from "jazz-tools";

const Person = co.map({
  name: z.string(),
  get bestFriend(): z.ZodOptional<typeof Person> { [!code --]
    return z.optional(Person); [!code --]
  get bestFriend(): co.Optional<typeof Person> { [!code ++]
    return co.optional(Person); [!code ++]
  }
});
```
</CodeGroup>

#### CoValue schema types are now under the `co.` namespace

All CoValue schema types are now accessed via the `co.` namespace. If you’re using explicit types (especially in recursive schemas), you’ll need to update them accordingly.

<CodeGroup>
```tsx
import { co, z } from "jazz-tools";

const Person = co.map({
  name: z.string(),
  get friends(): CoListSchema<typeof Person> { [!code --]
  get friends(): co.List<typeof Person> { [!code ++]
    return co.list(Person);
  }
});
```
</CodeGroup>

### Unsupported Zod methods have been removed from CoMap schemas

CoMap schemas no longer incorrectly inherit Zod methods like `.extend()` and `.partial()`. These methods previously appeared to work but could behave unpredictably. They’ve now been disabled.

In their place, .optional() has been added, and more Zod-like methods will be introduced in future releases.

### Internal schema access is now simpler

You no longer need to use Zod’s `.def` to access schema internals. Instead, you can directly use methods like `CoMapSchema.shape`, `CoListSchema.element`, and `CoOptionalSchema.innerType`.

<CodeGroup>
```tsx
import { co, z } from "jazz-tools";

const Message = co.map({
  content: co.richText(),
});

const Thread = co.map({
  messages: co.list(Message),
});

const thread = Thread.create({
  messages: Thread.def.shape.messages.create([ [!code --]
  messages: Thread.shape.messages.create([ [!code ++]
    Message.create({
      content: co.richText().create("Hi!"),
    }),
    Message.create({
      content: co.richText().create("What's up?"),
    }),
  ]),
});
```
</CodeGroup>

### Removed the deprecated `withHelper` method from CoValue schemas

The deprecated `withHelpers()` method has been removed from CoValue schemas. You can now define helper functions manually to encapsulate CoValue-related logic.
[Learn how to define helper methods](https://jazz.tools/docs/vanilla/schemas/covalues#helper-methods).
